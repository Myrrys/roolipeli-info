---
import ProductForm from '../../../components/admin/ProductForm.svelte';
import { defaultLang, ui } from '../../../i18n/ui';
import { useTranslations } from '../../../i18n/utils';
import AdminLayout from '../../../layouts/AdminLayout.astro';
import { createSupabaseServerClient } from '../../../lib/supabase';

const lang = (Astro.currentLocale as keyof typeof ui) || defaultLang;
const t = useTranslations(lang);
const title = t('admin.products.new');

const supabase = createSupabaseServerClient(Astro);
const supabaseUrl = import.meta.env.SUPABASE_URL?.split('\n')[0].trim();
const supabaseAnonKey = import.meta.env.SUPABASE_ANON_KEY?.split('\n')[0].trim();

// Fetch options for dropdowns
const { data: publishers } = await supabase.from('publishers').select('*').order('name');
const { data: creators } = await supabase.from('creators').select('*').order('name');
const { data: labels } = await supabase.from('semantic_labels').select('*').order('label');
---

<AdminLayout title={title}>
    <div class="page-header">
        <h1>{title}</h1>
    </div>

    <ProductForm
        publishers={publishers || []}
        creators={creators || []}
        labels={labels || []}
        submitUrl="/api/admin/products"
        method="POST"
        supabaseUrl={supabaseUrl}
        supabaseAnonKey={supabaseAnonKey}
        client:load
    />
</AdminLayout>

<style>
    .page-header {
        margin-bottom: var(--kide-space-6);
    }
    h1 {
        font-family: var(--kide-font-serif);
        font-size: 2rem;
        color: var(--kide-ink-header);
    }
</style>
