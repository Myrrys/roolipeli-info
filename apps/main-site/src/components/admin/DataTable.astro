---
/**
 * Generic data row with required id and dynamic fields accessed by column keys
 */
interface DataRow {
  id: string;
  [key: string]: unknown;
}

/**
 * Typed column definition â€” maps a data key to a pre-translated header
 */
interface ColumnDef {
  key: string;
  header: string;
}

interface Props {
  columns: ColumnDef[];
  data: DataRow[];
  editUrl: (id: string) => string;
  deleteAction?: boolean;
  actionsLabel: string;
  editLabel: string;
  deleteLabel: string;
  emptyText: string;
  itemCountText?: string;
}

const {
  columns,
  data,
  editUrl,
  deleteAction = true,
  actionsLabel,
  editLabel,
  deleteLabel,
  emptyText,
  itemCountText,
} = Astro.props;
---

<div class="admin-table-container">
    <table class="admin-table">
        <thead>
            <tr>
                {columns.map((col) => <th>{col.header}</th>)}
                <th class="actions-header">{actionsLabel}</th>
            </tr>
        </thead>
        <tbody>
            {
                data.map((row) => (
                    <tr>
                        {columns.map((col) => (
                            <td>{row[col.key]}</td>
                        ))}
                        <td class="actions-cell">
                            <a
                                href={editUrl(row.id)}
                                class="btn btn-icon btn-text edit"
                                aria-label={editLabel}
                            >
                                <span class="kide-icon kide-icon--sm" aria-hidden="true">edit</span>
                            </a>
                            {deleteAction && (
                                <button
                                    class="btn btn-icon btn-text delete"
                                    aria-label={deleteLabel}
                                    data-delete-id={row.id}
                                    onclick={`window.dispatchEvent(new CustomEvent('admin:confirm-delete', { detail: { id: '${row.id}' } }))`}
                                >
                                    <span class="kide-icon kide-icon--sm" aria-hidden="true">delete</span>
                                </button>
                            )}
                        </td>
                    </tr>
                ))
            }
            {
                data.length === 0 && (
                    <tr>
                        <td colspan={columns.length + 1} class="admin-table__empty">
                            <span class="kide-icon kide-icon--lg" aria-hidden="true">search_off</span>
                            <p>{emptyText}</p>
                        </td>
                    </tr>
                )
            }
        </tbody>
    </table>
</div>
{itemCountText && <p class="admin-table__count">{itemCountText}</p>}
