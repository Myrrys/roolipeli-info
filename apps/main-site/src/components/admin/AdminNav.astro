---
import NavRail from '@roolipeli/design-system/components/NavRail.astro';
import { defaultLang, ui } from '../../i18n/ui';
import { useTranslations } from '../../i18n/utils';

const { pathname } = Astro.url;
const lang = (Astro.currentLocale as keyof typeof ui) || defaultLang;
const t = useTranslations(lang);

const navItems = [
  { label: t('admin.dashboard'), href: '/admin' },
  { label: t('admin.products'), href: '/admin/products' },
  { label: t('admin.publishers'), href: '/admin/publishers' },
  { label: t('admin.creators'), href: '/admin/creators' },
  { label: t('admin.labels'), href: '/admin/labels' },
];

/**
 * Checks whether a nav item is active based on the current pathname.
 * Dashboard requires an exact match; other routes use prefix matching.
 */
const isActive = (href: string) => {
  if (href === '/admin') {
    return pathname === '/admin' || pathname === '/admin/';
  }
  return pathname.startsWith(href);
};
---

<NavRail aria-label="Admin navigation">
  <Fragment slot="header">
    <h2 class="admin-nav__brand">Roolipeli.info</h2>
    <span class="admin-nav__badge">Admin</span>
  </Fragment>

  {navItems.map((item) => (
    <li>
      <a
        href={item.href}
        class:list={['nav-rail__item', { 'nav-rail__item--active': isActive(item.href) }]}
      >
        <span class="nav-rail__label">{item.label}</span>
      </a>
    </li>
  ))}

  <Fragment slot="footer">
    <a href="/admin/logout" class="nav-rail__footer-link nav-rail__footer-link--danger">
      {t("admin.logout")}
    </a>
    <a href="/" class="nav-rail__footer-link">
      {t("admin.backToSite")}
    </a>
  </Fragment>
</NavRail>

<style>
  .admin-nav__brand {
    margin: 0;
    font-size: var(--kide-font-size-xl);
    color: var(--kide-ink-header);
  }

  .admin-nav__badge {
    display: inline-block;
    font-size: var(--kide-font-size-xs);
    font-weight: bold;
    text-transform: uppercase;
    background: var(--kide-ice-light);
    color: var(--kide-ice-deep);
    padding: calc(var(--kide-space-1) / 4) var(--kide-space-1);
    border-radius: var(--kide-radius-sm);
    margin-top: var(--kide-space-1);
  }
</style>
